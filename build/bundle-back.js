!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("passport")},function(e,t,n){const r=n(1),i=n(2),a=r.Schema({name:{type:String,required:!0},imageName:{type:String,required:!0},description:{type:String,trim:!0},comments:[{type:r.Schema.Types.ObjectId,ref:"Comment"}],creator:{type:r.Schema.Types.ObjectId,ref:"User"}},{timestamps:!0});a.virtual("imageUrl").get((function(){if(this.imageName)return"\\"+i.join("img","campImg",this.imageName)})),e.exports=r.model("Camp",a)},function(e,t){t.isLoggedIn=(e,t,n)=>{if(!e.isAuthenticated())return t.redirect("/login");n()},t.isCommentOwner=async(e,t,n)=>{if(e.isAuthenticated()||t.redirect("/login"),(await Comment.findById(e.params.id2)).author===e.user.username)return n();t.redirect("back")},t.isCampOwner=async(e,t,n)=>{if(!e.isAuthenticated())return t.redirect("back");if((await Camp.findById(e.params.id)).creator.equals(e.user._id))return n();t.redirect("back")}},function(e,t,n){const r=n(1),i=n(21),a=r.Schema({username:{type:String,required:!0,maxlength:20},password:{type:String,minlength:6},googleId:{type:String},thumbnail:{type:String,default:"https://tinyurl.com/y6qo86km"}});a.plugin(i),e.exports=r.model("User",a)},function(e,t,n){e.exports=n(8)},function(e,t,n){const r=n(2),i=n(0),a=n(9),o=n(10),s=n(3),c=n(11);n(12);const d=n(14),m=n(18),p=n(20),u=i();u.set("views",r.join("views")),u.set("view engine","ejs"),u.use(i.json()),u.use(i.urlencoded({extended:!1})),u.use(i.static(r.join("public"))),u.use(o("_method")),u.use(c({secret:"People don't like secrets but they keep it with them all the time.",resave:!1,saveUninitialized:!1})),u.use(s.initialize()),u.use(s.session()),n(22),u.use((e,t,n)=>{t.locals.user=e.user,n()}),u.get("/",(e,t)=>{t.render("home",{title:"Home"})}),u.use(p),u.use(d),u.use(m),u.get("*",(e,t)=>{t.render("404",{pageTitle:"404",error:"Page not found."})});const l=process.env.PORT||"3000";u.listen(l,()=>{console.log(a.blue("=====================")),console.log(a.bold("http://localhost:"+a.bold.red(l))),console.log(a.blue("====================="))})},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("express-session")},function(e,t,n){const r=n(1);n(13).config();(async()=>{try{await r.connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}),console.log("database connected!!")}catch(e){console.log(e)}})()},function(e,t){e.exports=require("dotenv")},function(e,t,n){const r=n(0).Router(),i=n(2),a=n(15),o=n(16),s=n(4),{userInfo:c}=n(17),{isLoggedIn:d,isCampOwner:m}=n(5),p=o({dest:i.join("public","img","campImg"),limits:1e5,fileFilter(e,t,n){t.originalname.match(/\.(jpg|jpeg|png|gif)$/i)||n(new Error("File type not allowed.")),n(null,!0)}});r.get("/camps",async(e,t)=>{try{const e=await s.find({}).populate("creator").exec();t.render("camps/index",{pageTitle:"Camps",camps:e})}catch(e){t.redirect("/"),console.log(e)}}),r.post("/camps",p.single("campImg"),d,async(e,t)=>{try{const n=new s({name:e.body.campName,imageName:e.file.filename,description:e.body.description,creator:e.user._id});await n.save(),t.redirect("/camps")}catch(e){t.redirect("/camps"),console.log(e)}}),r.get("/camps/new",d,(e,t)=>{t.render("camps/new",{pageTitle:"Add Camp"})}),r.get("/camps/:id",async(e,t)=>{try{const n=await s.findById(e.params.id).populate("comments").exec();t.render("camps/show",{pageTitle:n.name,camp:n})}catch(e){t.redirect("camps"),console.log(e)}}),r.get("/camps/:id/edit",m,async(e,t)=>{try{const n=await s.findById(e.params.id);t.render("camps/edit",{pageTitle:"Edit camp",camp:n})}catch(n){t.redirect("/camps/"+e.params.id),console.log(n)}}),r.put("/camps/:id",m,p.single("campImg"),async(e,t)=>{try{const n=await s.findById(e.params.id);e.file&&(a.unlink(i.join("public","img","campImg",n.imageName),e=>{if(e)throw e}),n.imageName=e.file.filename),e.body.name&&(n.name=e.body.name),e.body.description&&(n.description=e.body.description),await n.save(),t.redirect("/camps/"+e.params.id)}catch(n){t.redirect("/camps/"+e.params.id),console.log(n)}}),r.delete("/camps/:id",m,async(e,t)=>{try{const n=await s.findById(e.params.id);a.unlink(i.join("public","img","campImg",n.imageName),e=>{if(e)throw e}),await n.remove(),t.redirect("/camps")}catch(e){t.redirect("/camps"),console.log(e)}}),e.exports=r},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("os")},function(e,t,n){const r=n(0).Router(),i=n(4),a=n(19),{isLoggedIn:o,isCommentOwner:s}=n(5);r.post("/camps/:id/comments",o,async(e,t)=>{try{const n=await i.findById(e.params.id),r=new a({content:e.body.content,author:e.user.username});await r.save(),n.comments.push(r),await n.save(),t.redirect("/camps/"+e.params.id)}catch(n){t.redirect("/camps/"+e.params.id),console.log(n)}}),r.get("/camps/:id1/comments/:id2/edit",s,async(e,t)=>{const n=await a.findById(e.params.id2);t.render("comments/edit",{pageTitle:"Edit comments",campId:e.params.id1,comment:n})}),r.put("/camps/:id1/comments/:id2",o,async(e,t)=>{const n=await a.findById(e.params.id2);e.body.content&&(n.content=e.body.content),await n.save(),t.redirect("/camps/"+e.params.id1)}),r.delete("/camps/:id1/comments/:id2",s,async(e,t)=>{const n=await a.findById(e.params.id2);await n.remove(),t.redirect("/camps/"+e.params.id1)}),e.exports=r},function(e,t,n){const r=n(1),i=r.Schema({content:{type:String,trim:!0},author:{type:String},date:{type:Date,default:Date.now}});e.exports=r.model("Comment",i)},function(e,t,n){const r=n(0).Router(),i=n(6),a=n(3);r.get("/register",(e,t)=>{t.render("auth/register",{pageTitle:"Register"})}),r.post("/register",async(e,t)=>{try{if(1===(await i.find({username:e.body.username})).length)throw new Error("username already used.");const n=new i({username:e.body.username});await n.setPassword(e.body.password),await n.save(),a.authenticate("local")(e,t,()=>{t.redirect("/camps")})}catch(e){console.log(e),t.redirect("/register")}}),r.get("/login",(e,t)=>{t.render("auth/login",{pageTitle:"Login"})}),r.post("/login",a.authenticate("local",{successRedirect:"/camps",failureRedirect:"/login"}),(e,t)=>{}),r.get("/auth/google",a.authenticate("google",{scope:["profile"]})),r.get("/auth/google/cb",a.authenticate("google"),(e,t)=>{t.redirect("/camps")}),r.get("/logout",(e,t)=>{e.logout(),t.redirect("/camps")}),e.exports=r},function(e,t){e.exports=require("passport-local-mongoose")},function(e,t,n){const r=n(3),i=n(23).Strategy,a=n(24).Strategy,o=n(6);r.serializeUser(o.serializeUser()),r.deserializeUser(o.deserializeUser()),r.use(new i(o.authenticate())),r.use(new a({clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:"/auth/google/cb"},async(e,t,n,r)=>{try{const e=await o.findOne({googleId:n.id});if(e)return r(null,e);const t=new o({username:n.displayName,googleId:n.id,thumbnail:n.photos[0].value});await t.save(),r(null,t)}catch(e){console.log(e)}}))},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("passport-google-oauth20")}]);