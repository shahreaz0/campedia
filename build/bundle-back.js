!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("passport")},function(e,t,r){const i=r(1),n=r(2),a=i.Schema({name:{type:String,required:!0},imageName:{type:String,required:!0},description:{type:String,trim:!0},comments:[{type:i.Schema.Types.ObjectId,ref:"Comment"}],creator:{type:i.Schema.Types.ObjectId,ref:"User"}},{timestamps:!0});a.virtual("imageUrl").get((function(){if(this.imageName)return"\\"+n.join("img","campImg",this.imageName)})),e.exports=i.model("Camp",a)},function(e,t,r){const i=r(1),n=r(20),a=i.Schema({username:{type:String,required:!0,maxlength:20},password:{type:String,minlength:6},googleId:{type:String},thumbnail:{type:String,default:"https://tinyurl.com/y6qo86km"}});a.plugin(n),e.exports=i.model("User",a)},function(e,t,r){e.exports=r(7)},function(e,t,r){const i=r(2),n=r(0),a=r(8),o=r(9),s=r(3),c=r(10);r(11);const d=r(13),p=r(17),m=r(19),u=n();u.set("views",i.join("views")),u.set("view engine","ejs"),u.use(n.json()),u.use(n.urlencoded({extended:!1})),u.use(n.static(i.join("public"))),u.use(o("_method")),u.use(c({secret:"People don't like secrets but they keep it with them all the time.",resave:!1,saveUninitialized:!1})),u.use(s.initialize()),u.use(s.session()),r(21),u.use((e,t,r)=>{t.locals.user=e.user,r()}),u.get("/",(e,t)=>{t.render("home",{title:"Home"})}),u.use(m),u.use(d),u.use(p),u.get("*",(e,t)=>{t.render("404",{pageTitle:"404",error:"Page not found."})});const l=process.env.PORT||"3000";u.listen(l,()=>{console.log(a.blue("=====================")),console.log(a.bold("http://localhost:"+a.bold.red(l))),console.log(a.blue("====================="))})},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("express-session")},function(e,t,r){const i=r(1);r(12).config();(async()=>{try{await i.connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}),console.log("database connected!!")}catch(e){console.log(e)}})()},function(e,t){e.exports=require("dotenv")},function(e,t,r){const i=r(0).Router(),n=r(2),a=r(14),o=r(15),s=r(4),{userInfo:c}=r(16),d=(e,t,r)=>{if(!e.isAuthenticated())return t.redirect("/login");r()},p=async(e,t,r)=>{if(!e.isAuthenticated())return t.redirect("back");if((await s.findById(e.params.id)).creator.equals(e.user._id))return r();t.redirect("back")},m=o({dest:n.join("public","img","campImg"),limits:1e5,fileFilter(e,t,r){t.originalname.match(/\.(jpg|jpeg|png|gif)$/i)||r(new Error("File type not allowed.")),r(null,!0)}});i.get("/camps",async(e,t)=>{try{const e=await s.find({}).populate("creator").exec();t.render("camps/index",{pageTitle:"Camps",camps:e})}catch(e){t.redirect("/"),console.log(e)}}),i.post("/camps",m.single("campImg"),d,async(e,t)=>{try{const r=new s({name:e.body.campName,imageName:e.file.filename,description:e.body.description,creator:e.user._id});await r.save(),t.redirect("/camps")}catch(e){t.redirect("/camps"),console.log(e)}}),i.get("/camps/new",d,(e,t)=>{t.render("camps/new",{pageTitle:"Add Camp"})}),i.get("/camps/:id",async(e,t)=>{try{const r=await s.findById(e.params.id).populate("comments").exec();t.render("camps/show",{pageTitle:r.name,camp:r})}catch(e){t.redirect("camps"),console.log(e)}}),i.get("/camps/:id/edit",p,async(e,t)=>{try{const r=await s.findById(e.params.id);t.render("camps/edit",{pageTitle:"Edit camp",camp:r})}catch(r){t.redirect("/camps/"+e.params.id),console.log(r)}}),i.put("/camps/:id",p,m.single("campImg"),async(e,t)=>{try{const r=await s.findById(e.params.id);e.file&&(a.unlink(n.join("public","img","campImg",r.imageName),e=>{if(e)throw e}),r.imageName=e.file.filename),e.body.name&&(r.name=e.body.name),e.body.description&&(r.description=e.body.description),await r.save(),t.redirect("/camps/"+e.params.id)}catch(r){t.redirect("/camps/"+e.params.id),console.log(r)}}),i.delete("/camps/:id",p,async(e,t)=>{try{const r=await s.findById(e.params.id);a.unlink(n.join("public","img","campImg",r.imageName),e=>{if(e)throw e}),await r.remove(),t.redirect("/camps")}catch(e){t.redirect("/camps"),console.log(e)}}),e.exports=i},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("os")},function(e,t,r){const i=r(0).Router(),n=r(4),a=r(18),o=(e,t,r)=>{if(!e.isAuthenticated())return t.redirect("/login");r()},s=async(e,t,r)=>{if(e.isAuthenticated()||t.redirect("/login"),(await a.findById(e.params.id2)).author===e.user.username)return r();t.redirect("back")};i.post("/camps/:id/comments",o,async(e,t)=>{try{const r=await n.findById(e.params.id),i=new a({content:e.body.content,author:e.user.username});await i.save(),r.comments.push(i),await r.save(),t.redirect("/camps/"+e.params.id)}catch(r){t.redirect("/camps/"+e.params.id),console.log(r)}}),i.get("/camps/:id1/comments/:id2/edit",s,async(e,t)=>{const r=await a.findById(e.params.id2);t.render("comments/edit",{pageTitle:"Edit comments",campId:e.params.id1,comment:r})}),i.put("/camps/:id1/comments/:id2",o,async(e,t)=>{const r=await a.findById(e.params.id2);e.body.content&&(r.content=e.body.content),await r.save(),t.redirect("/camps/"+e.params.id1)}),i.delete("/camps/:id1/comments/:id2",s,async(e,t)=>{const r=await a.findById(e.params.id2);await r.remove(),t.redirect("/camps/"+e.params.id1)}),e.exports=i},function(e,t,r){const i=r(1),n=i.Schema({content:{type:String,trim:!0},author:{type:String},date:{type:Date,default:Date.now}});e.exports=i.model("Comment",n)},function(e,t,r){const i=r(0).Router(),n=r(5),a=r(3);i.get("/register",(e,t)=>{t.render("auth/register",{pageTitle:"Register"})}),i.post("/register",async(e,t)=>{try{if(1===(await n.find({username:e.body.username})).length)throw new Error("username already used.");const r=new n({username:e.body.username});await r.setPassword(e.body.password),await r.save(),a.authenticate("local")(e,t,()=>{t.redirect("/camps")})}catch(e){console.log(e),t.redirect("/register")}}),i.get("/login",(e,t)=>{t.render("auth/login",{pageTitle:"Login"})}),i.post("/login",a.authenticate("local",{successRedirect:"/camps",failureRedirect:"/login"}),(e,t)=>{}),i.get("/auth/google",a.authenticate("google",{scope:["profile"]})),i.get("/auth/google/cb",a.authenticate("google"),(e,t)=>{t.redirect("/camps")}),i.get("/logout",(e,t)=>{e.logout(),t.redirect("/camps")}),e.exports=i},function(e,t){e.exports=require("passport-local-mongoose")},function(e,t,r){const i=r(3),n=r(22).Strategy,a=r(23).Strategy,o=r(5);i.serializeUser(o.serializeUser()),i.deserializeUser(o.deserializeUser()),i.use(new n(o.authenticate())),i.use(new a({clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:"/auth/google/cb"},async(e,t,r,i)=>{try{const e=await o.findOne({googleId:r.id});if(e)return i(null,e);const t=new o({username:r.displayName,googleId:r.id,thumbnail:r.photos[0].value});await t.save(),i(null,t)}catch(e){console.log(e)}}))},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("passport-google-oauth20")}]);