!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=6)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("passport")},function(e,t,o){const n=o(1),r=o(2),i=n.Schema({name:{type:String,required:!0},imageName:{type:String,required:!0},description:{type:String,trim:!0},comments:[{type:n.Schema.Types.ObjectId,ref:"Comment"}]},{timestamps:!0});i.virtual("imageUrl").get((function(){if(this.imageName)return"\\"+r.join("img","campImg",this.imageName)})),e.exports=n.model("Camp",i)},function(e,t,o){const n=o(1),r=o(20),i=n.Schema({username:{type:String,required:!0,maxlength:20},password:{type:String,minlength:6},googleId:{type:String},thumbnail:{type:String,default:"https://tinyurl.com/y6qo86km"}});i.plugin(r),e.exports=n.model("User",i)},function(e,t,o){e.exports=o(7)},function(e,t,o){const n=o(2),r=o(0),i=o(8),a=o(9),s=o(3),c=o(10);o(11);const l=o(13),p=o(17),u=o(19),m=r();m.set("views",n.join("views")),m.set("view engine","ejs"),m.use(r.json()),m.use(r.urlencoded({extended:!1})),m.use(r.static(n.join("public"))),m.use(a("_method")),m.use(c({secret:"People don't like secrets but they keep it with them all the time.",resave:!1,saveUninitialized:!1})),m.use(s.initialize()),m.use(s.session()),o(21),m.use((e,t,o)=>{t.locals.user=e.user,o()}),m.get("/",(e,t)=>{t.render("home",{title:"Home"})}),m.use(u),m.use(l),m.use(p),m.get("*",(e,t)=>{t.render("404",{pageTitle:"404",error:"Page not found."})});const d=process.env.PORT||"3000";m.listen(d,()=>{console.log(i.blue("=====================")),console.log(i.bold("http://localhost:"+i.bold.red(d))),console.log(i.blue("====================="))})},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("express-session")},function(e,t,o){const n=o(1);o(12).config();(async()=>{try{await n.connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}),console.log("database connected!!")}catch(e){console.log(e)}})()},function(e,t){e.exports=require("dotenv")},function(e,t,o){const n=o(0).Router(),r=o(2),i=o(14),a=o(15),s=o(4),{userInfo:c}=o(16),l=(e,t,o)=>{if(!e.isAuthenticated())return t.redirect("/login");o()},p=a({dest:r.join("public","img","campImg"),limits:1e5,fileFilter(e,t,o){t.originalname.match(/\.(jpg|jpeg|png|gif)$/i)||o(new Error("File type not allowed.")),o(null,!0)}});n.get("/camps",async(e,t)=>{try{const o=await s.find({});t.render("camps/index",{pageTitle:"Camps",camps:o,user:e.user})}catch(e){t.redirect("/"),console.log(e)}}),n.post("/camps",p.single("campImg"),l,async(e,t)=>{try{const o=new s({name:e.body.campName,imageName:e.file.filename,description:e.body.description});await o.save(),t.redirect("/camps")}catch(e){t.redirect("/camps"),console.log(e)}}),n.get("/camps/new",l,(e,t)=>{t.render("camps/new",{pageTitle:"Add Camp"})}),n.get("/camps/:id",async(e,t)=>{try{const o=await s.findById(e.params.id).populate("comments").exec();t.render("camps/show",{pageTitle:o.name,camp:o})}catch(e){t.redirect("camps"),console.log(e)}}),n.get("/camps/:id/edit",async(e,t)=>{try{const o=await s.findById(e.params.id);t.render("camps/edit",{pageTitle:"Edit camp",camp:o})}catch(o){t.redirect("/camps/"+e.params.id),console.log(o)}}),n.put("/camps/:id",p.single("campImg"),async(e,t)=>{try{const o=await s.findById(e.params.id);i.unlink(r.join("public","img","campImg",o.imageName),e=>{if(e)throw e}),o.name=e.body.name,o.description=e.body.description,o.imageName=e.file.filename,await o.save(),t.redirect("/camps/"+e.params.id)}catch(o){t.redirect("/camps/"+e.params.id),console.log(o)}}),n.delete("/camps/:id",async(e,t)=>{try{const o=await s.findById(e.params.id);i.unlink(r.join("public","img","campImg",o.imageName),e=>{if(e)throw e}),await o.remove(),t.redirect("/camps")}catch(e){t.redirect("/camps"),console.log(e)}}),e.exports=n},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("os")},function(e,t,o){const n=o(0).Router(),r=o(4),i=o(18);n.post("/camps/:id/comments",async(e,t)=>{try{const o=await r.findById(e.params.id),n=new i({content:e.body.content,author:e.body.author});await n.save(),o.comments.push(n),await o.save(),t.redirect("/camps/"+e.params.id)}catch(o){t.redirect("/camps/"+e.params.id),console.log(o)}}),e.exports=n},function(e,t,o){const n=o(1),r=n.Schema({content:{type:String,trim:!0},author:{type:String}});e.exports=n.model("Comment",r)},function(e,t,o){const n=o(0).Router(),r=o(5),i=o(3);n.get("/register",(e,t)=>{t.render("auth/register",{pageTitle:"Register"})}),n.post("/register",async(e,t)=>{try{if(1===(await r.find({username:e.body.username})).length)throw new Error("username already used.");const o=new r({username:e.body.username});await o.setPassword(e.body.password),await o.save(),i.authenticate("local")(e,t,()=>{t.redirect("/camps")})}catch(e){console.log(e),t.redirect("/register")}}),n.get("/login",(e,t)=>{t.render("auth/login",{pageTitle:"Login"})}),n.post("/login",i.authenticate("local",{successRedirect:"/camps",failureRedirect:"/login"}),(e,t)=>{}),n.get("/auth/google",i.authenticate("google",{scope:["profile"]})),n.get("/auth/google/cb",i.authenticate("google"),(e,t)=>{t.redirect("/camps")}),n.get("/logout",(e,t)=>{e.logout(),t.redirect("/camps")}),e.exports=n},function(e,t){e.exports=require("passport-local-mongoose")},function(e,t,o){const n=o(3),r=o(22).Strategy,i=o(23).Strategy,a=o(5);n.serializeUser(a.serializeUser()),n.deserializeUser(a.deserializeUser()),n.use(new r(a.authenticate())),n.use(new i({clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:"/auth/google/cb"},async(e,t,o,n)=>{try{const e=await a.findOne({googleId:o.id});if(e)return n(null,e);const t=new a({username:o.displayName,googleId:o.id,thumbnail:o.photos[0].value});await t.save(),n(null,t)}catch(e){console.log(e)}}))},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("passport-google-oauth20")}]);