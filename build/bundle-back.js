!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=6)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("passport")},function(e,t,o){const r=o(1),n=o(2),i=r.Schema({name:{type:String,required:!0},imageName:{type:String,required:!0},description:{type:String,trim:!0},comments:[{type:r.Schema.Types.ObjectId,ref:"Comment"}],creator:{type:r.Schema.Types.ObjectId,ref:"User"}},{timestamps:!0});i.virtual("imageUrl").get((function(){if(this.imageName)return"\\"+n.join("img","campImg",this.imageName)})),e.exports=r.model("Camp",i)},function(e,t,o){const r=o(1),n=o(20),i=r.Schema({username:{type:String,required:!0,maxlength:20},password:{type:String,minlength:6},googleId:{type:String},thumbnail:{type:String,default:"https://tinyurl.com/y6qo86km"}});i.plugin(n),e.exports=r.model("User",i)},function(e,t,o){e.exports=o(7)},function(e,t,o){const r=o(2),n=o(0),i=o(8),a=o(9),s=o(3),c=o(10);o(11);const l=o(13),p=o(17),u=o(19),m=n();m.set("views",r.join("views")),m.set("view engine","ejs"),m.use(n.json()),m.use(n.urlencoded({extended:!1})),m.use(n.static(r.join("public"))),m.use(a("_method")),m.use(c({secret:"People don't like secrets but they keep it with them all the time.",resave:!1,saveUninitialized:!1})),m.use(s.initialize()),m.use(s.session()),o(21),m.use((e,t,o)=>{t.locals.user=e.user,o()}),m.get("/",(e,t)=>{t.render("home",{title:"Home"})}),m.use(u),m.use(l),m.use(p),m.get("*",(e,t)=>{t.render("404",{pageTitle:"404",error:"Page not found."})});const d=process.env.PORT||"3000";m.listen(d,()=>{console.log(i.blue("=====================")),console.log(i.bold("http://localhost:"+i.bold.red(d))),console.log(i.blue("====================="))})},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("express-session")},function(e,t,o){const r=o(1);o(12).config();(async()=>{try{await r.connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}),console.log("database connected!!")}catch(e){console.log(e)}})()},function(e,t){e.exports=require("dotenv")},function(e,t,o){const r=o(0).Router(),n=o(2),i=o(14),a=o(15),s=o(4),{userInfo:c}=o(16),l=(e,t,o)=>{if(!e.isAuthenticated())return t.redirect("/login");o()},p=a({dest:n.join("public","img","campImg"),limits:1e5,fileFilter(e,t,o){t.originalname.match(/\.(jpg|jpeg|png|gif)$/i)||o(new Error("File type not allowed.")),o(null,!0)}});r.get("/camps",async(e,t)=>{try{const e=await s.find({}).populate("creator").exec();console.log(e),t.render("camps/index",{pageTitle:"Camps",camps:e})}catch(e){t.redirect("/"),console.log(e)}}),r.post("/camps",p.single("campImg"),l,async(e,t)=>{try{const o=new s({name:e.body.campName,imageName:e.file.filename,description:e.body.description,creator:e.user._id});await o.save(),t.redirect("/camps")}catch(e){t.redirect("/camps"),console.log(e)}}),r.get("/camps/new",l,(e,t)=>{t.render("camps/new",{pageTitle:"Add Camp"})}),r.get("/camps/:id",async(e,t)=>{try{const o=await s.findById(e.params.id).populate("comments").exec();console.log(o),t.render("camps/show",{pageTitle:o.name,camp:o})}catch(e){t.redirect("camps"),console.log(e)}}),r.get("/camps/:id/edit",async(e,t)=>{try{const o=await s.findById(e.params.id);t.render("camps/edit",{pageTitle:"Edit camp",camp:o})}catch(o){t.redirect("/camps/"+e.params.id),console.log(o)}}),r.put("/camps/:id",p.single("campImg"),async(e,t)=>{try{const o=await s.findById(e.params.id);i.unlink(n.join("public","img","campImg",o.imageName),e=>{if(e)throw e}),o.name=e.body.name,o.description=e.body.description,o.imageName=e.file.filename,await o.save(),t.redirect("/camps/"+e.params.id)}catch(o){t.redirect("/camps/"+e.params.id),console.log(o)}}),r.delete("/camps/:id",async(e,t)=>{try{const o=await s.findById(e.params.id);i.unlink(n.join("public","img","campImg",o.imageName),e=>{if(e)throw e}),await o.remove(),t.redirect("/camps")}catch(e){t.redirect("/camps"),console.log(e)}}),e.exports=r},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("os")},function(e,t,o){const r=o(0).Router(),n=o(4),i=o(18);r.post("/camps/:id/comments",(e,t,o)=>{if(!e.isAuthenticated())return t.redirect("/login");o()},async(e,t)=>{try{const o=await n.findById(e.params.id),r=new i({content:e.body.content,author:e.user.username});await r.save(),o.comments.push(r),await o.save(),t.redirect("/camps/"+e.params.id)}catch(o){t.redirect("/camps/"+e.params.id),console.log(o)}}),e.exports=r},function(e,t,o){const r=o(1),n=r.Schema({content:{type:String,trim:!0},author:{type:String},date:{type:Date,default:Date.now}});e.exports=r.model("Comment",n)},function(e,t,o){const r=o(0).Router(),n=o(5),i=o(3);r.get("/register",(e,t)=>{t.render("auth/register",{pageTitle:"Register"})}),r.post("/register",async(e,t)=>{try{if(1===(await n.find({username:e.body.username})).length)throw new Error("username already used.");const o=new n({username:e.body.username});await o.setPassword(e.body.password),await o.save(),i.authenticate("local")(e,t,()=>{t.redirect("/camps")})}catch(e){console.log(e),t.redirect("/register")}}),r.get("/login",(e,t)=>{t.render("auth/login",{pageTitle:"Login"})}),r.post("/login",i.authenticate("local",{successRedirect:"/camps",failureRedirect:"/login"}),(e,t)=>{}),r.get("/auth/google",i.authenticate("google",{scope:["profile"]})),r.get("/auth/google/cb",i.authenticate("google"),(e,t)=>{t.redirect("/camps")}),r.get("/logout",(e,t)=>{e.logout(),t.redirect("/camps")}),e.exports=r},function(e,t){e.exports=require("passport-local-mongoose")},function(e,t,o){const r=o(3),n=o(22).Strategy,i=o(23).Strategy,a=o(5);r.serializeUser(a.serializeUser()),r.deserializeUser(a.deserializeUser()),r.use(new n(a.authenticate())),r.use(new i({clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:"/auth/google/cb"},async(e,t,o,r)=>{try{const e=await a.findOne({googleId:o.id});if(e)return r(null,e);const t=new a({username:o.displayName,googleId:o.id,thumbnail:o.photos[0].value});await t.save(),r(null,t)}catch(e){console.log(e)}}))},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("passport-google-oauth20")}]);